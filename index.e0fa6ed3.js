var t={};class e{static defaultInitialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];static GameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=e.defaultInitialState){this.board=t.map(t=>[...t]),this.score=0,this.status=e.GameStatus.idle,this.initialState=t.map(t=>[...t])}getState(){return this.board}getScore(){return this.score}getStatus(){return this.status}start(){this.status=e.GameStatus.playing,this.newCell(),this.newCell()}restart(){this.status=e.GameStatus.idle,this.score=0,this.board=this.initialState.map(t=>[...t])}newCell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)this.board[e][s]||t.push({y:e,x:s});if(t.length>0){let e=Math.floor(Math.random()*t.length);this.board[t[e].y][t[e].x]=.9>Math.random()?2:4}}checkGameState(){this.board.find(t=>t.find(t=>2048===t))?this.status=e.GameStatus.win:this.checkIfLose()&&(this.status=e.GameStatus.lose)}checkIfLose(){if(this.board.find(t=>t.includes(0)))return!1;for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(t<3&&this.board[t][e]===this.board[t+1][e]||e<3&&this.board[t][e]===this.board[t][e+1])return!1;return!0}move(t){if("playing"!==this.status)return!1;let e=!1,s=Array.from({length:4},()=>[!1,!1,!1,!1]),a=(t,e=!1)=>{for(let s=0;s<4;s++)for(let a=0;a<4;a++)t(e?3-s:s,e?3-a:a)},r=(t,a,r,i)=>{if(0!==this.board[t][a]){let o=t,l=a;for(;o+r>=0&&o+r<4&&l+i>=0&&l+i<4&&0===this.board[o+r][l+i];)o+=r,l+=i;o+r>=0&&o+r<4&&l+i>=0&&l+i<4&&this.board[o+r][l+i]===this.board[t][a]&&!s[o+r][l+i]?(this.board[o+r][l+i]*=2,this.score+=this.board[o+r][l+i],this.board[t][a]=0,s[o+r][l+i]=!0,e=!0):(o!==t||l!==a)&&(this.board[o][l]=this.board[t][a],this.board[t][a]=0,e=!0)}};return"up"===t?a((t,e)=>r(t,e,-1,0)):"down"===t?a((t,e)=>r(3-t,e,1,0)):"left"===t?a((t,e)=>r(t,e,0,-1)):"right"===t&&a((t,e)=>r(t,3-e,0,1)),e&&(this.newCell(),this.checkGameState()),e}moveUp(){return this.move("up")}moveDown(){return this.move("down")}moveLeft(){return this.move("left")}moveRight(){return this.move("right")}}const s=new(t=e),a=document.querySelector(".button"),r=document.querySelector(".game-score"),i=document.querySelectorAll("tr"),o=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),n=document.querySelector(".message-win");function d(){r.textContent=s.getScore();let t=s.getState();for(let e=0;e<4;e++)for(let s=0;s<4;s++){let a=i[e].cells[s];if(0===t[e][s])a.firstChild&&a.removeChild(a.firstChild);else if(!a.firstChild||a.firstChild.textContent!==t[e][s]){a.innerHTML="";let r=document.createElement("div");r.className=`field-cell-num field-cell--${t[e][s]}`,r.textContent=t[e][s],a.appendChild(r)}}}a.addEventListener("click",()=>{s.getStatus()===t.GameStatus.idle?(a.textContent="Restart",a.classList.add("restart"),a.classList.remove("start"),o.classList.add("hidden"),s.start()):(a.textContent="Start",a.classList.add("start"),a.classList.remove("restart"),n.classList.add("hidden"),l.classList.add("hidden"),o.classList.remove("hidden"),s.restart()),d()}),document.addEventListener("keydown",e=>{let a=!1;if("playing"===s.getStatus()){switch(e.key){case"ArrowUp":a=s.moveUp();break;case"ArrowDown":a=s.moveDown();break;case"ArrowLeft":a=s.moveLeft();break;case"ArrowRight":a=s.moveRight()}a&&setTimeout(()=>{d(),function(){let e=s.getStatus();e===t.GameStatus.win?n.classList.remove("hidden"):e===t.GameStatus.lose&&l.classList.remove("hidden")}()},100)}});
//# sourceMappingURL=index.e0fa6ed3.js.map
